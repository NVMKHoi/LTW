CREATE DATABASE QUAN_LI_DE_AN3
USE QUAN_LI_DE_AN3

CREATE TABLE DEAN (
	MADA INT NOT NULL PRIMARY KEY,
	TENDEAN CHAR(20),
	KINHPHI FLOAT,
	)
CREATE TABLE PHONGBAN (
	MAPB INT NOT NULL PRIMARY KEY,
	TENPB CHAR(20),
	DIADIEM CHAR (20),
	)
CREATE TABLE NHANVIEN (
	MANV INT NOT NULL PRIMARY KEY,
	TENNV CHAR(30),
	NGAYSINH DATE,
	GT CHAR(3),
	)
ALTER TABLE NHANVIEN
ADD MAPB INT FOREIGN KEY REFERENCES PHONGBAN(MAPB)
GO
ALTER TABLE PHONGBAN 
ADD MATP INT FOREIGN KEY REFERENCES NHANVIEN(MANV)
GO
CREATE TABLE THAMGIA (
	MANV INT NOT NULL,
	MADA INT NOT NULL,
	NGAYBD DATE,
	CHUCVU CHAR(15),
	PRIMARY KEY (MANV,MADA)
	)

INSERT INTO DEAN 
VALUES 
(1, 'SHOP QUAN AO', 200),
(2, 'GAME DOI KHANG', 250),
(3, 'TRACKER', 400),
(4, 'BAI GIU XE', 150),
(5, 'WEB NLU', 10);

INSERT INTO PHONGBAN
VALUES
(101, 'DEV', 'NONG LAM', 2),
(102, 'TEST', 'BINH DUONG', 3),
(103, 'UI', 'NONG LAM', 4),
(104, 'SELL', 'QUAN 1', 10);

INSERT INTO NHANVIEN
VALUES
(1, 'MINH KHOI', '10-11-2003', 'NAM', NULL),
(2, 'MINH KHUI', '12-21-2002', 'NAM', NULL),
(3, 'MINH KHOAI', '9-1-2001', 'NAM', NULL),
(4, 'MINH KHONG', '8-21-2000', 'NAM', NULL),
(5, 'MINH KHUONG', '10-23-1993', 'NU', NULL),
(6, 'MINH KHANG', '10-21-1993', 'NAM', NULL),
(7, 'MINH KIET', '4-1-1989', 'NAM', NULL),
(8, 'MINH KIEN', '8-14-1995', 'NAM', NULL),
(9, 'MINH KHANH', '10-31-1996', 'NAM', NULL),
(10, 'MINH HOANG', '1-18-1996', 'NAM', NULL);
UPDATE NHANVIEN 
SET MAPB = 101
WHERE MANV BETWEEN 1 AND 4;
UPDATE NHANVIEN 
SET MAPB = 102
WHERE MANV BETWEEN 5 AND 7;
UPDATE NHANVIEN 
SET MAPB = 103
WHERE MANV BETWEEN 8 AND 9;
UPDATE NHANVIEN 
SET MAPB = 104
WHERE MANV = 10
INSERT INTO THAMGIA
VALUES
(1, 1, '5-5-2015', 'LEADER'),
(2, 1, '5-5-2015', 'MEM'),
(3, 1, '5-5-2015', 'MEM'),
(4, 1, '5-5-2015', 'MEM'),
(2, 2, '5-5-2015', 'LEADER'),
(4, 2, '5-5-2015', 'MEM'),
(5, 2, '5-5-2015', 'MEM'),
(6, 2, '5-5-2015', 'MEM'),
(7, 2, '5-5-2015', 'MEM'),
(3, 3, '5-5-2015', 'LEADER'),
(9, 3, '5-5-2015', 'DEV'),
(8, 3, '5-5-2015', 'MEM'),
(10, 3, '5-5-2015', 'MEM');

SELECT PHONGBAN.MAPB, PHONGBAN.TENPB, COUNT(*) AS SLNV 
FROM PHONGBAN JOIN NHANVIEN ON PHONGBAN.MAPB = NHANVIEN.MAPB
GROUP BY PHONGBAN.MAPB, PHONGBAN.TENPB

SELECT DEAN.MADA, DEAN.TENDEAN, COUNT(*) AS SLNV 
FROM DEAN JOIN THAMGIA ON DEAN.MADA = THAMGIA.MADA
GROUP BY  DEAN.MADA, DEAN.TENDEAN

SELECT TENPB, NHANVIEN.TENNV AS TRUONG_PHONG
FROM PHONGBAN JOIN NHANVIEN ON PHONGBAN.MATP = NHANVIEN.MANV
GROUP BY TENPB, NHANVIEN.TENNV 